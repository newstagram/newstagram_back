# .github/workflows/mirror-to-gitlab.yml
name: Mirror to GitLab

on:
  push:
    branches:
      - master  # master ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰

jobs:
  mirror-to-gitlab:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ëª¨ë“  Git íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      - name: Push to GitLab Repository 1
        env:
          GITLAB_URL_1: ${{ secrets.GITLAB_URL_1 }}
          GITLAB_ACCESS_TOKEN_1: ${{ secrets.GITLAB_ACCESS_TOKEN_1 }}
        run: |
          echo "ğŸš€ Pushing to GitLab Repository 1..."
          
          # GitLab URLì— OAuth2 í† í°ì„ í¬í•¨í•˜ì—¬ ì¸ì¦
          GITLAB_REPO_URL=$(echo "$GITLAB_URL_1" | sed "s|://|://oauth2:$GITLAB_ACCESS_TOKEN_1@|")
          
          # master ë¸Œëœì¹˜ë¡œ í‘¸ì‹œ (GitLabì˜ ê¸°ë³¸ ë¸Œëœì¹˜)
          git push --force "$GITLAB_REPO_URL" master:master
          git push --force --tags "$GITLAB_REPO_URL"
          
          echo "âœ… Successfully pushed to GitLab Repository 1."

      - name: Push to GitLab Repository 2
        env:
          GITLAB_URL_2: ${{ secrets.GITLAB_URL_2 }}
          GITLAB_ACCESS_TOKEN_2: ${{ secrets.GITLAB_ACCESS_TOKEN_2 }}
        run: |
          echo "ğŸš€ Pushing to GitLab Repository 2..."
          
          # GitLab URLì— OAuth2 í† í°ì„ í¬í•¨í•˜ì—¬ ì¸ì¦
          GITLAB_REPO_URL=$(echo "$GITLAB_URL_2" | sed "s|://|://oauth2:$GITLAB_ACCESS_TOKEN_2@|")
          
          # master ë¸Œëœì¹˜ë¡œ í‘¸ì‹œ (GitLabì˜ ê¸°ë³¸ ë¸Œëœì¹˜)
          git push --force "$GITLAB_REPO_URL" master:master
          git push --force --tags "$GITLAB_REPO_URL"
          
          echo "âœ… Successfully pushed to GitLab Repository 2."

      - name: Summary
        run: |
          echo "ğŸ“‹ Mirror Summary"
          echo "================="
          echo "âœ… GitHub main â†’ GitLab 1 master"
          echo "âœ… GitHub main â†’ GitLab 2 master"
          echo "ğŸ‰ All repositories synchronized!"